<!doctype html>
<html>

<head>
	<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<meta charset="utf-8">
	<title>edit_OL</title>
	<style type="text/css">
		body {
			background-image: url(images/bei6.jpg);
			background-size: cover;
			background-position: center top;
			background-repeat: no-repeat;
			background-attachment: fixed;
			overflow: hidden;
		}

		html {
			height: 100%;
		}

		a {
			text-decoration: none;
		}

		#title {
			position: absolute;
			left: 0px;
			top: 0px;
			width: 100%;
			height: 64px;
			border: none;
			border-radius: 0px;
			background-color: rgba(0, 80, 255, 0);
			box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.349019607843137);
			-moz-box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.349019607843137);
			-webkit-box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.349019607843137);
		}

		#logo {
			position: absolute;
			left: 0px;
			width: 56px;
			height: 56px;
			text-align: center;
		}

		#title_t {
			position: absolute;
			margin-left: 56px;
			height: 56px;
			float: left;
			text-align: center;
			color: #FFF;
			font-family: '宋体 常规', '宋体';
			font-weight: 400;
			font-style: normal;
			font-size: 25px;
			line-height: 56px
		}

		#tou {
			position: relative;
			width: 200px;
			height: 56px;
			text-align: center;
			float: right;
		}

		#yaoq {
			cursor: pointer;
			color: #FFFFFF;
			width: 56px;
			height: 56px;
			font-size: 20px;
			margin-right: 50px;
		}

		#tou_img {
			width: 48px;
			height: 48px;
		}

		#msg {
			position: absolute;
			right: 0%;
			float: right;
			width: 23%;
			margin-top: 60px;
			height: 100%;
			color: #FFFFFF;
			font-size: 20px;
			background-color: rgba(0, 0, 0, 0.2);
			-moz-box-shadow: -8px 0px 30px rgba(0, 0, 0, 0.349019607843137);
			-webkit-box-shadow: -8px 0px 30px rgba(0, 0, 0, 0.349019607843137);
			box-shadow: -8px 0px 30px rgba(0, 0, 0, 0.349019607843137);
		}

		#tab {
			border: none;
			left: 0%;
			width: 100%;
			color: #FFFFFF;
			margin-top: 60px;
			text-align: left;
			height: 100%;
			/* 	overflow:scroll; 
	height: 100px;
	overflow-x: hidden; */
		}

		.lie {
			font-size: 20px;
			color: #ccc;
		}

		.img1 {
			opacity: 0.8;
			cursor: pointer;
			width: 36px;
			height: 36px;
			margin-left: 20px;
			height: 36px;
		}

		.img2 {
			opacity: 0.8;
			width: 100%;
		}

		#tan {
			padding: 10px;
			position: absolute;
			float: left;
			z-index: 50;
			width: 400px;
			height: 200px;
			border-radius: 2px;
			background: #FFFFFF;
			-moz-box-shadow: 0px 0px 10px rgba(174, 174, 174, 0.349019607843137);
			-webkit-box-shadow: 0px 0px 10px rgba(174, 174, 174, 0.349019607843137);
			box-shadow: 0px 0px 10px rgba(174, 174, 174, 0.349019607843137);
			left: 50%;
			top: 50%;
			margin-top: -100px;
			margin-left: -200px;
			text-align: center;
		}

		.name_t {
			margin-top: 10px;
			background-color: #FAFAFA;
			width: 60%;
			height: 56px;
			border: none;
			outline: none;
			font-size: 20px;
		}

		#login_b {
			cursor: pointer;
			border-radius: 2px;
			line-height: 56px;
			margin-left: 20%;
			margin-top: 20px;
			color: #FFF;
			background-color: #448AFF;
			width: 60%;
			height: 56px;
			border: none;
			outline: none;
			font-size: 20px;
			-moz-box-shadow: 2px 2px 2px rgba(174, 174, 174, 0.349019607843137);
			-webkit-box-shadow: 2px 2px 2px rgba(174, 174, 174, 0.349019607843137);
			box-shadow: 2px 2px 2px rgba(174, 174, 174, 0.349019607843137);
			border-radius: 2px;
		}


		#del {
			cursor: pointer;
			text-align: center;
			color: #FFFFFF;
			background-color: rgba(0, 0, 0, 0.2);
			height: 56px;
			line-height: 56px;
			font-size: 20px;
		}

		#cha {
			cursor: pointer;
		}
	</style>
	<script type="text/javascript">
		var xmlhttp;
		var winlink = "http://" + window.location.href.substring(7, window.location.href.indexOf(":", 7));

		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		}
		else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		var json;
		var session = window.sessionStorage;
		var by = session.getItem("uid");

		function xuan(e) {
			var rows = document.getElementById("tab").rows;
			var div_del = document.getElementById('del');
			for (var i = 1; i < rows.length; i++) {
				rows[i].style.cssText = "background-color: rgba(3, 169, 244, 0);";;
			}
			this.style.cssText = "background-color: rgba(3, 169, 244, 0.2);";
			var str = this.cells[5].innerHTML;
			document.getElementById("con").innerHTML = str;
			var textLeng = 200;
			if (str.length > textLeng) {
				document.getElementById("con").innerHTML = str.substring(0, textLeng ) + "... ...";
			}
			div_del.title = this.cells[4].innerHTML;
		}

		function go_edit() {
			//session.removeItem("file");
			window.location = winlink + ":8888/edit?id=" + this.title;
		}
		function init() {
			if (by === null)
				window.location.href = winlink + ":8888/";

			xmlhttp.open("post", winlink + ":8888/getf", true);
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var tab = document.getElementById("tab");
					var trr = document.getElementById("tr");
					tab.innerHTML = '';
					tab.appendChild(trr);
					var res = xmlhttp.responseText;
					var json = JSON.parse(res);
					session.setItem("res", res);
					var title_t = document.getElementById("title_t");
					for (var i = 0; i < json.length; i++) {
						var tr = document.createElement("tr");
						var tdd = document.createElement("td");
						var img = document.createElement("img");
						img.src = "images/u4.png";
						img.className = "img1"
						tdd.appendChild(img);
						tdd.height = '64px';
						tr.appendChild(tdd);
						img.onclick = go_edit;
						for (var t in json[i]) {
							var td = document.createElement("td");
							if (t === "file_name")
								td.innerHTML = json[i][t];
							else if (t === "file_by")
								td.innerHTML = session.name;
							else if (t === "file_date")
								td.innerHTML = json[i][t];
							else if (t === "id") {
								td.innerHTML = json[i][t];
								img.title = json[i][t];
								td.style.display = "none";
							}
							else if (t === "file_text") {
								td.innerHTML = json[i][t];
								td.style.display = "none";
							}
							else
								continue;
							tr.appendChild(td);
						}
						tab.appendChild(tr);

					}
					var rows = tab.rows;
					for (var i = 1; i < rows.length; i++) {
						rows[i].onclick = xuan;
					}
					title_t.innerHTML = '<a style="cursor: pointer;" onclick="javascript :history.back(-1)" >edit</a>' + ' > ' + session.name;
				}

			}
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.send("by=" + by);

			document.getElementById("tan").style.display = "none";

		}

		function jia() {
			document.getElementById("tan").style.display = "";
		}
		function cha() {
			document.getElementById("tan").style.display = "none";
		}
		function up() {
			document.getElementById("tan").style.display = "";
		}
		function jinru(){
			window.location.href = winlink + ":8888/edit?id="+document.getElementById("fname").value;
		}

		function del() {
			var div_del = document.getElementById('del');
			if (div_del.title.length == 0)
				alert("请选择要删除的文件");
			xmlhttp.open("post", winlink + ":8888/delf", true);
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var bd = document.getElementById('bd');
					bd.onload();

					div_del.title = '';
				}

			}
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlhttp.send("id=" + div_del.title);

		}
		function addf() {
			//var name = document.getElementById("fname").value;

			var name = document.getElementById("wjName").value;
			if (name.length === 0)
				alert("文件名为空");
			else {
				//document.getElementById("tan").style.display = "none";

				xmlhttp.open("post", winlink + ":8888/addf", true);
				xmlhttp.onreadystatechange = function () {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {

						var bd = document.getElementById('bd');
						bd.onload();

					}

				}
				xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				xmlhttp.send("name=" + name + "&by=" + by);

			}

		}
	</script>
</head>

<body id="bd" onload="init()">
	<div id="tan">
		<div style="height: 36px;	text-align: right; font-size: 36px; margin-right: 10px;"><span id="cha" onclick="cha()">×</span></div>
		<input type="text" class="name_t" id="fname" name="filename" placeholder="请输入邀请码" spellcheck="false" />
		<div id="login_b" onclick="jinru()">进入</div>
	</div>
	<div id="title"></div>
	<div id="title_t">edit_OL > 朱成龙</div>
	<div id="logo">
		<img id="tou_img" src="images/logo.png">
	</div>
	<div id="tou" onclick="jia()">
		<span id="yaoq">受邀</span><img id="tou_img" src="images/tou.gif">
	</div>
	<div style="overflow-x: hidden; overflow-y: auto; height:auto; width: 80%; float: left;">
		<table id="tab" width="auto" border="0" cellpadding="0" cellspacing="0">
			<tr id='tr'>
				<td class="lie" width="5%" height="64px" valign="middle"><img src="images/jia.png" class="img1" data-toggle="modal" data-target="#myModal" /></td>
				<td class="lie" width="20%">名称</td>
				<td class="lie" width="20%">创建者</td>
				<td class="lie" width="20%">时间</td>
				<td class="lie" width="1%"></td>
				<td class="lie" width="1%"></td>
			</tr>

		</table>
	</div>
	<div id="msg">

		<img class="img2" src="images/bei.jpg" />
		<div id="del" onclick="del()">删除</div>
		<div id="con" style="padding: 16px;"></div>
	</div>


	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModal" tabindex="-1" style='margin-top:10%' role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
					<h4 class="modal-title" id="myModalLabel">
						新增文件
					</h4>
				</div>
				<div class="modal-body">
					<input id="wjName" type="text" class="form-control" placeholder="文件名">

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal" onclick="addf();">
					提交
				</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>
</body>

</html>